name: Discord Commit Notifier

on:
  push:
    branches:
      - master   # or your branch

jobs:
  discord:
    runs-on: ubuntu-latest

    steps:
      - name: Send commit info to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          # Get the latest commit details
          COMMIT_MESSAGE=$(git log -1 --pretty=%B)
          COMMIT_AUTHOR=$(git log -1 --pretty=%an)
          COMMIT_URL=$(git log -1 --pretty=%H)
          REPO_NAME=${GITHUB_REPOSITORY}
          BRANCH_NAME=${GITHUB_REF#refs/heads/}

          # Build the JSON payload
          JSON_PAYLOAD=$(jq -n \
            --arg title "New commit pushed to $BRANCH_NAME" \
            --arg description "$COMMIT_MESSAGE" \
            --arg author "$COMMIT_AUTHOR" \
            --arg repo "$REPO_NAME" \
            --arg url "https://github.com/$REPO_NAME/commit/$COMMIT_URL" \
            '{
              username: "GitHub Bot",
              embeds: [{
                title: $title,
                url: $url,
                description: $description,
                color: FFCFF1,
                author: { name: $author },
                footer: { text: "Repository: \($repo)" },
                timestamp: now | todate
              }]
            }')

          # Send to Discord
          curl -H "Content-Type: application/json" -d "$JSON_PAYLOAD" $DISCORD_WEBHOOK
